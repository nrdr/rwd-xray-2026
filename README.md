![Welcome to rwd-xray 2026!](https://cdn.discordapp.com/attachments/868284810794238043/1457491085336117453/image.png?ex=695c31d9&is=695ae059&hm=0e16550c8841ae178eae5dff963ededbb65eac4f30ce2ed160118ebc3cb04e23&)

### Usage:

EPS tool:

`python eps_tool.py` with user.bin in same directory to generate patched rwd. Will be written as `user_patched.rwd`.
`python eps_tool.py -stock` with user.bin in same directory to generate stock rwd. Will be written as `user.rwd`.

### Patches:

fw version contains "," for detection by openpilot   
minimum steer speed reduced to 0mph  

### Torque tables & openpilot tuning

To write up your own custom torque table, check out the torque calculator spreadsheet also located in `rwd-xray/tools`.

By default, the spreadsheet uses the “spike” at the end approach (modifying the last 1–2 entries). This preserves Honda Sensing LKAS behavior as OEM intended, but it comes with the drawback of not being perfectly linear.

Most newer controllers (Torque Controller / NNLC) work best when your delivered torque is **predictable and smooth**. Achieving a “linear feel” is not as simple as drawing a straight line, because the EPS has its own hard-baked response characteristics. As such, it's best to show ChatGPT or another AI your TorqueV for your specific car so it can draw the correct line to be linear.

#### Torque limits / safety notes

At the current time, `32,767` (`0x7FFF`) is the maximum stable torque value that can be represented due to 16-bit signed integer limits. (Credit: Aragon7777)

The `filter_table` and `new_table` should typically be left alone unless you know what you are doing. Messing with these values can cause severe EPS behavior (including loud grinding and possible damage). (Credit: Aragon7777)

#### Tune `interface.py` after flashing (TorqueBP / TorqueV)

After flashing a new torque table, you should ensure openpilot’s steering tuning matches the EPS behavior, otherwise you may see:
- torque “build-up” then releasing late,
- oscillation/overshoot,
- the controller fighting itself because the internal model no longer matches the EPS.

In your openpilot fork, update the steering tuning in `interface.py` (opendbc_repo/cars or wherever your fork stores the tuning):
- **TorqueBP**: breakpoints (command axis)
- **TorqueV**: expected delivered torque values at those breakpoints (0-3840 is typical for Honda)

General guidance:
- Update `TorqueBP` `TorqueV` using the spreadsheet calculator (at the bottom) for your car if you used the standard non-linear tune.
- Unless you have done further testing, it is best to copy those values directly into `interface.py` directly. Hex is accepted.

#### Optional: add a low-pass filter to reduce “twitchy” steering

[Example 1](https://github.com/sunnypilot/opendbc/commit/b1304c6a92d846471da975e6abed5d632955dde7)

If the steering feels buzzy/twitchy after a flash, [add a simple low-pass filter](https://github.com/sunnypilot/opendbc/commit/b1304c6a92d846471da975e6abed5d632955dde7) to the **commanded steering output**.


### rwd_to_fullbin.py

The `rwd_to_fullbin.py` tool reconstructs a full firmware `.bin` from a Honda `.rwd.gz` calibration file.

#### Usage

```bash
python3 rwd_to_fullbin.py path/to/firmware.rwd.gz -o user.bin
```

Note that bins generated by the `rwd_to_fullbin.py` tool may not necessarily have the same bin file hash as the originals. To make it work with EPS tool, be sure to find out the hash of your bin first. 

Powershell: `Get-FileHash .\user.bin -Algorithm MD5`

Example: `D392CD7CF1173E43F3A1D1F4E31523E3`

Then, replace that hash in `eps_tool.py` under your car. Example: `input_bin_hash == 'D392CD7CF1173E43F3A1D1F4E31523E3':`


### Supported known versions:

39990-TLA-A040 Honda CR-V,   
39990-TBA-A030 Honda Civic Sedan,
39990-TEG-A010 Honda Civic Sedan (Japan),
39990-TBA-C120 Honda Civic Sedan 2019, 
39990-TBA-C020 Honda Civic Sedan Sport 2019, 
39990-TEA-T330 Honda Civic Hatch (Australia),   
39990-TGG-A120 Honda Civic Hatch (LX, EX/-L),
39990-TGN-E120 Honda Civic Hatch (Europe),
39990-TGG-A020 Honda Civic Hatch (Sport/Sport Touring), 
39990-TRW-A020 Honda Clarity,   
39990-TXM-A040 Honda Insight.  

# table_search.py
### Usage:

`Python3 table_search.py -bytes 18` with user.bin in same directory to find addresses with consecutive matching sets of 18 bytes. This assumes tables will have at least one set of matching adjacent rows.

# rwd-xray
Honda/Acura calibration file (rwd) firmware extractor

NOTE THAT THIS IS A WORK IN PROGRESS AND THE ONLY FIRMWARE THAT MAY WORK IS 39990-TV9-A910

### Usage
From a terminal using python 3.x:  
`./rwd-xray.py ./39990-TEG-A010.rwd.gz`

This will output a file containing the firmware named:  
`39990-TEG-A010.bin`

### What are .rwd files?

Part of the Honda Diagnostic System (HDS) software is a tool to flash firmware updates (J2534 Rewrite application) and a set of firmware update files.

The firmeware update files can be found in the directory:  
`C:\Program Files (x86)\Honda\J2534 Pass Thru\CalibFiles`

Each firmware file is named according to the part number  
(usually found printed on outside of the part)  
`MODULE-VEHICLE-VERSION.rwd.gz`

for example, here is a firmware update for a 2016 Acura ILX EPS module:  
`39990-TV9-A910.rwd.gz`

|token|value|description|
|-----|-----|-----------|
|`MODULE`|39990|EPS module|
|`VEHICLE`|TV9|Acura ILX|
|`VERSION`|A910|manufacturer region/code|

See the [File Name Vehicle Reference](./FILENAME_VEHICLE_REFERENCE.md) to see what model and year each rwd file corresponds to.

## .rwd File Formats
Each file has a signature, headers, firmware and checksum

---

### Z (0x5a) format
TODO:
- [x] signature
- [x] headers
    - [x] encryption keys
- [ ] firmware
    - [x] cipher
    - [ ] checksums - need to find some to validate

(many files use this format)

##### SIGNATURE
```
+---+
|S←↓|
+---+
```

|label|bytes|description|
|----:|----:|-----------|
|S|1|signature (0x5a)|
|←↓|2|delimiter (0x0d0a)|

##### HEADERS
```
+-+-+=====+===+-+=====+
|C|L|V...V|...|L|V...V|
+-+-+=====+===+-+=====+
|C|L|V...V|...|L|V...V|
+-+-+=====+===+-+=====+
|C|L|V...V|...|L|V...V|
+-+-+=====+===+-+=====+
|C|L|V...V|...|L|V...V|
+-+-+=====+===+-+=====+
|C|L|V...V|...|L|V...V|
+-+-+=====+===+-+=====+
|C|L|V...V|...|L|V...V|
+-+-+=====+===+-+=====+
```

|label|bytes|description|
|----:|----:|-----------|
|C|1|number of values in header (can be zero)|
|L|1|length header value|
|V|varies|header value (length = preceding L)|

##### FIRMWARE
```
+--------+
|SSSSSSSS|
+--------+
|LLLLLLLL|
+--------+-------+
|DDDDDDDDDDDDDDDD|
| ...            |
| (repeat)       |
| ...            |
|DDDDDDDDDDDDDDDD|
+----+-----------+
```

|label|bytes|description|
|----:|----:|-----------|
|S|8|start address of firmware block|
|L|8|length of firmware block|
|D|varies|data (length = last end of block address)|

##### CHECKSUM
```
+----+
|CCCC|
+----+
```

|label|bytes|description|
|----:|----:|-----------|
|C|4|sum of all bytes in file (excluding these bytes)|

---

### 1 (0x31) format
TODO:
- [x] signature
- [x] headers
    - [x] encryption keys
- [ ] firmware
    - [x] cipher
    - [ ] checksums - validated for 39990-TV9-A910, can we generalize for all files?

(many files use this format)

##### SIGNATURE
```
+---+
|S←↓|
+---+
```

|label|bytes|description|
|----:|----:|-----------|
|S|1|signature (0x31)|
|←↓|2|delimiter (0x0d0a)|

##### HEADERS
```
+---+=======+===+=======+---+
|T←↓|V...V←↓|...|V...V←↓|T←↓|
+---+=======+===+=======+---+
|T←↓|V...V←↓|...|V...V←↓|T←↓|
+---+=======+===+=======+---+
|T←↓|V...V←↓|...|V...V←↓|T←↓|
+---+=======+===+=======+---+
|T←↓|V...V←↓|...|V...V←↓|T←↓|
+---+=======+===+=======+---+
|T←↓|V...V←↓|...|V...V←↓|T←↓|
+---+=======+===+=======+---+
|T←↓|V...V←↓|...|V...V←↓|T←↓|
+---+=======+===+=======+---+
```

|label|bytes|description|
|----:|----:|-----------|
|T|1|type of header|
|V|varies|header value|
|←↓|2|delimiter (0x0d0a)|

##### FIRMWARE
```
+----+----------------+
|AAAA|DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
+----+----------------+
| ...                 |
| (repeat)            |
| ...                 |
+----+----------------+
|AAAA|DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
|    |DDDDDDDDDDDDDDDD|
+----+----------------+
```

|label|bytes|description|
|----:|----:|-----------|
|A|4|address >> 4|
|D|128|data|

##### CHECKSUM
```
+----+
|CCCC|
+----+
```

|label|bytes|description|
|----:|----:|-----------|
|C|4|sum of all bytes in file (excluding these bytes)|

---

### X (0x58) format
TODO:
- [x] signature
- [ ] headers
- [ ] firmware

(very few files in this format)

##### SIGNATURE
```
+---+
|S←↓|
+---+
```

|label|bytes|description|
|----:|----:|-----------|
|S|1|signature (0x58)|
|←↓|2|delimiter (0x0d0a)|

##### HEADERS
TBD

##### FIRMWARE
TBD

---

### Y (0x59) format
TODO:
- [x] signature
- [ ] headers
- [ ] firmware

(very few files in this format)

##### SIGNATURE
```
+---+
|S←↓|
+---+
```

|label|bytes|description|
|----:|----:|-----------|
|S|1|signature (0x59)|
|←↓|2|delimiter (0x0d0a)|

##### HEADERS
TBD

##### FIRMWARE
TBD

---

### 0 (0x30) format
TODO:
- [x] signature
- [ ] headers
- [ ] firmware

(very few files in this format)

##### SIGNATURE
```
+---+
|S←↓|
+---+
```

|label|bytes|description|
|----:|----:|-----------|
|S|1|signature (0x30)|
|←↓|2|delimiter (0x0d0a)|

##### HEADERS
TBD

##### FIRMWARE
TBD

---

credit goes to george hotz for reverse engineering the first firmware cipher
